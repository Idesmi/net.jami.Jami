name: jami-daemon
buildsystem: meson
config-opts:
  - -Dbuildtype=release
  - -Dportaudio=disabled
  - -Djack=disabled
  - -Dopensl=disabled
  - -Daec=enabled
  - -Dname_service=enabled
  - -Dinterfaces=library,dbus
  - -Dcpp_args='-DMSGPACK_NO_BOOST'
sources:
  - type: git
    url: https://git.jami.net/savoirfairelinux/jami-daemon.git
    commit: 374abb938204760a9b8534fa23ee2ba8cea5f045
  - type: file
    url: https://github.com/savoirfairelinux/pjproject/archive/4af5d666d18837abaac94c8ec6bfc84984dcf1e2.tar.gz
    sha256: 2f0311924c895fc0abfbeebdd43576b758756f2bbd2aa2f1edf997b1852fdc70
    dest-filename: pjproject-4af5d666d18837abaac94c8ec6bfc84984dcf1e2.tar.gz
  - type: file
    url: https://git.ffmpeg.org/gitweb/ffmpeg.git/snapshot/n5.0.tar.gz
    sha256: defdae95d594fb3485beb3e9ee68485e165d6b297236410806bec6dc35fabab8
    dest-filename: ffmpeg-n5.0.tar.gz
  - type: patch
    path: ../files/jami-daemon_no-udev.patch
  - type: shell
    commands:
      - mkdir contrib/native
      - mv pjproject-4af5d666d18837abaac94c8ec6bfc84984dcf1e2.tar.gz contrib/tarballs
      - mv ffmpeg-n5.0.tar.gz contrib/tarballs
      - autoreconf -fvi
      - cd contrib/native && ../bootstrap --prefix=/app --disable-downloads --disable-all --enable-pjproject --enable-ffmpeg
      - cd contrib/native && make DEPS_pjproject= DEPS_ffmpeg=
