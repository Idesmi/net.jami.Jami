name: jami-daemon
buildsystem: meson
config-opts:
  - -Dportaudio=disabled
  - -Djack=disabled
  - -Dopensl=disabled
  - -Daec=enabled
  - -Dname_service=enabled
sources:
  - type: git
    url: https://git.jami.net/savoirfairelinux/jami-daemon.git
    commit: f8830b789411846016a657c5da992d97fec66c45
  - type: file
    url: https://github.com/savoirfairelinux/pjproject/archive/e1f389d0b905011e0cb62cbdf7a8b37fc1bcde1a.tar.gz
    sha256: 32507bced0f4bad566a568b210924cae5f149e83ce248e391924bfb587c0508f
    dest-filename: pjproject-e1f389d0b905011e0cb62cbdf7a8b37fc1bcde1a.tar.gz
  - type: patch
    path: ../patches/jami-daemon_no-udev.patch
  - type: patch
    path: ../patches/jami-daemon_fix-ice.patch
  - type: shell
    commands:
      - mkdir contrib/native
      - mv pjproject-e1f389d0b905011e0cb62cbdf7a8b37fc1bcde1a.tar.gz contrib/tarballs
      - autoreconf -fvi
      - cd contrib/native && ../bootstrap --prefix=/app --disable-downloads --disable-all --enable-pjproject
      - cd contrib/native && make DEPS_pjproject=
